---
- defaults:
    link:
      relink: true
    create:
      mode: 0755
    shell:
      stdin: true
      stdout: true
      stderr: true

- shell:
  - xcode-select --install || true
  - sudo softwareupdate --install-rosetta || true
  - /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  - export PATH="/opt/homebrew/bin:/opt/homebrew/sbin:${PATH}" && brew bundle install

- create:
  - ~/Workspace
  - ~/.config
  - ~/Library/Application Support/iTerm2

- create:
    ~/.ssh:
      mode: 0700
    ~/.ssh/keys:
      mode: 0700

- link:
    ~/.config/starship.toml: starship/starship.toml
    ~/.dive.yaml:
    ~/.gitignore:
    ~/.gitconfig:
    ~/.gitconfig-tencent:
    ~/.ssh/conf.d: ssh/conf.d
    ~/.ssh/config: ssh/config
    ~/.zshrc:
    ~/.zsh:
      force: true
    ~/Library/Application Support/iTerm2/DynamicProfiles:
      path: iterm2/DynamicProfiles
      force: true

- shell:
  - command: |
      local email
      printf 'Email address used to log into 1password: '
      read email

      op signin my.1password.com "$email"
    description: Log into 1Password.
    quiet: true

  - |
    scripts/sshkeys.zsh \
      personal:ubckouhr3vd4njzutpc3k64la4:otdk3omgpbatxkq4ultfxghyui \
      tencent:7rh4f2nyvfg3hpxn53qxun6jke:ye3wb6dg7ja3bpbkfg4hv354ny

